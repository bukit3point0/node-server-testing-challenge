
exports.up = function(knex) {
    return knex.schema
    .createTable('merch_types', tbl => {
        tbl.increments('merch_type_id')
        tbl.string('merch_type_name')
    })
    .createTable('mediums', tbl => {
        tbl.increments('medium_id')
        tbl.string('medium_name')  
    })
    .createTable('creators', tbl => {
        tbl.increments('creator_id')
        tbl.string('creator_name')
            .notNullable()
            .unique()
        tbl.string('creator_stage_name')
            .unique()
        tbl.string('creator_company_name')
        tbl.string('email_address')
            .unique()
    })
    .createTable('panels', tbl => {
        tbl.increments('panel_id')
        tbl.string('panel_name').notNullable().unique()
        tbl.string('panel_description')
        tbl.string('time').notNullable()
        tbl.string('date').notNullable()
    })
    .createTable('moderators', tbl => {
        tbl.increments('moderator_id')
        tbl.integer('creator_id')
            .unsigned()
            // .notNullable()
            .references('creator_id')
            .inTable('creators')
            .onDelete('CASCADE')
        tbl.integer('panel_id')
            .unsigned()
            .notNullable()
            .references('panel_id')
            .inTable('panels')
            .onDelete('CASCADE')
    })
    .createTable('creator_merch', tbl => {
        tbl.increments('creator_merch_id')
        tbl.string('creator_merch_name').notNullable()
        tbl.int('copies').notNullable()
        tbl.integer('creator_id')
            .unsigned()
            .notNullable()
            .references('creator_id')
            .inTable('creators')
            .onDelete('CASCADE')
        tbl.integer('merch_type_id')
            .unsigned()
            .notNullable()
            .references('merch_type_id')
            .inTable('merch_types')
            .onDelete('CASCADE')
    })
    .createTable('creator_mediums', tbl => {
        tbl.increments('creator_medium_id')
        tbl.integer('creator_id')
            .unsigned()
            .notNullable()
            .references('creator_id')
            .inTable('creators')
            .onDelete('CASCADE')
        tbl.integer('medium_id')
            .unsigned()
            .notNullable()
            .references('medium_id')
            .inTable('mediums')
            .onDelete('CASCADE')
    })
    .createTable('creator_panels', tbl => {
        tbl.increments('creator_panel_id')
        tbl.integer('creator_id')
            .unsigned()
            // .notNullable()
            .references('creator_id')
            .inTable('creators')
            .onDelete('CASCADE')
        tbl.integer('panel_id')
            .unsigned()
            .notNullable()
            .references('panel_id')
            .inTable('panels')
            .onDelete('CASCADE')
    })
};

exports.down = function(knex) {
  return knex.schema
  .dropTableIfExists('creator_panels')
  .dropTableIfExists('creator_mediums')
  .dropTableIfExists('creator_merch')
  .dropTableIfExists('moderators')
  .dropTableIfExists('panels')
  .dropTableIfExists('creators')
  .dropTableIfExists('mediums')
  .dropTableIfExists('merch_types')
};
